import{d as $,r,i as E,b as p,c as a,a as e,h as f,t as i,F as V,f as z,o,n as k,w as A,v as M,g,_ as P}from"./index-_x3iZeZW.js";const R=$({name:"D1AdminPanelView",setup(){const n=r([]),t=r(!1),c=r(""),m=r(null),h=r(!1),v=r(""),l=r(null),u=async()=>{try{t.value=!0,c.value="";const s=await p.get("https://knowledge-base-backend.leechiuhui.workers.dev/D1AdminPanel");if(s.data.success)n.value=s.data.data;else throw new Error(s.data.message)}catch(s){console.error("載入錯誤:",s),c.value=s instanceof Error?s.message:"載入資料時發生錯誤"}finally{t.value=!1}},b=s=>s||"未知",y=s=>new Date(s).toLocaleString("zh-TW"),w=async s=>{if(confirm("確定要刪除此筆記錄嗎？")){m.value=s;try{await p.delete("https://knowledge-base-backend.leechiuhui.workers.dev/D1AdminPanel",{data:{id:s}}),n.value=n.value.filter(d=>d.id!==s)}catch(d){console.error("刪除錯誤:",d),c.value="刪除記錄時發生錯誤"}finally{m.value=null}}},D=s=>{var d;l.value=s,h.value=!0,v.value=((d=n.value.find(I=>I.id===s))==null?void 0:d.content)||""},C=async s=>{console.log("saveEdit",v.value),l.value=null,h.value=!1,await p.patch("https://knowledge-base-backend.leechiuhui.workers.dev/D1AdminPanel",{id:s,content:v.value}).then(d=>{console.log("response",d),u()})};return E(()=>{u()}),{records:n,isLoading:t,error:c,isDeletingId:m,formatFileSize:b,formatDate:y,deleteRecord:w,editingId:l,editMode:h,editContent:v,editRecord:D,saveEdit:C}}}),F={class:"d1-admin-container"},L={class:"panel-section"},S={key:0,class:"loading-state"},B={key:1,class:"error-message"},N={class:"ui negative message"},T={key:2,class:"data-table"},U={class:"ui celled table"},W={class:"file-type"},j={class:"content-cell"},q={key:0},G={class:"ui mini vertical buttons"},H=["onClick"],J=["onClick"],K=["onClick"];function O(n,t,c,m,h,v){return o(),a("main",F,[t[9]||(t[9]=e("h1",{class:"panel-title"},"D1 資料庫管理面板",-1)),e("div",L,[t[8]||(t[8]=e("div",{class:"section-header"},[e("i",{class:"database icon"}),e("h2",null,"知識庫索引資料列表")],-1)),n.isLoading?(o(),a("div",S,t[1]||(t[1]=[e("i",{class:"spinner loading icon"},null,-1),e("span",null,"正在載入資料...",-1)]))):f("",!0),n.error?(o(),a("div",B,[e("div",N,[t[2]||(t[2]=e("i",{class:"close icon"},null,-1)),t[3]||(t[3]=e("div",{class:"header"},"發生錯誤",-1)),e("p",null,i(n.error),1)])])):f("",!0),n.records.length>0?(o(),a("div",T,[e("table",U,[t[7]||(t[7]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"向量化狀態"),e("th",null,"檔案路徑"),e("th",null,"檔案名稱"),e("th",null,"檔案大小"),e("th",null,"檔案類型"),e("th",null,"上傳時間"),e("th",null,"向量化時間"),e("th",null,"檔案內容"),e("th",null,"操作")])],-1)),e("tbody",null,[(o(!0),a(V,null,z(n.records,l=>(o(),a("tr",{key:l.id},[e("td",null,i(l.id),1),e("td",null,[e("div",{class:k(["ui label",l.havebeenIndexed?"green":"yellow"])},i(l.havebeenIndexed?"已向量化":"未向量化"),3)]),e("td",null,i(l.filepath),1),e("td",null,i(l.filename),1),e("td",null,i(n.formatFileSize(l.filesize)),1),e("td",W,i(l.filetype),1),e("td",null,i(n.formatDate(l.uploadeddate)),1),e("td",null,i(l.indexeddate?n.formatDate(l.indexeddate):"尚未向量化"),1),e("td",j,[!n.editMode||n.editingId!==l.id?(o(),a("span",q,i(l.content),1)):A((o(),a("textarea",{key:1,"onUpdate:modelValue":t[0]||(t[0]=u=>n.editContent=u),rows:"10"},null,512)),[[M,n.editContent]])]),e("td",null,[e("div",G,[n.editMode?(o(),a("button",{key:1,class:"ui mini primary button",onClick:u=>n.saveEdit(l.id)},t[5]||(t[5]=[e("i",{class:"save icon"},null,-1),g("保存")]),8,J)):(o(),a("button",{key:0,class:"ui mini primary button",onClick:u=>n.editRecord(l.id)},t[4]||(t[4]=[e("i",{class:"edit icon"},null,-1),g("編輯")]),8,H)),e("button",{class:k(["ui mini button",{loading:n.isDeletingId===l.id}]),onClick:u=>n.deleteRecord(l.id)},t[6]||(t[6]=[e("i",{class:"trash icon"},null,-1),g("刪除整個檔案")]),10,K)])])]))),128))])])])):f("",!0)])])}const X=P(R,[["render",O],["__scopeId","data-v-5c9d9a34"]]);export{X as default};
