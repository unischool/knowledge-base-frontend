import{d as F,r as n,a as V,c as a,h as $,b as e,w as b,v as h,f as D,e as N,F as z,g as E,t as d,i as L,o,_ as U}from"./index-BkAgoPqU.js";const B=F({name:"AdminPanelView",setup(){const t=n(""),s=n([]),v=n(!1),p=n(""),m=n(""),g=n([]),l=n(!1),u=n(""),y=n(""),k=n(""),w=n([]),R=n(!1),I=n("");return{indexName:t,result:s,isLoading:v,error:p,createIndex:async()=>{var c;if(!t.value.trim()){alert("請輸入索引名稱");return}v.value=!0,p.value="",s.value=[];try{const i=await V.get("https://knowledge-base-backend.leechiuhui.workers.dev/vectorize/createVectorizeIndex/"+encodeURIComponent(t.value),{headers:{"Content-Type":"application/json"}});console.log(i),s.value=[{status:"成功",message:"索引建立完成"}]}catch(i){console.error(i);const r=(c=i.response)==null?void 0:c.data;p.value=(r==null?void 0:r.message)||"建立索引時發生錯誤"}finally{v.value=!1}},deleteIndexName:m,deleteResult:g,isDeleteLoading:l,deleteError:u,deleteIndex:async()=>{var c;if(!m.value.trim()){alert("請輸入索引名稱");return}l.value=!0,u.value="",g.value=[];try{const i=await V.get("https://knowledge-base-backend.leechiuhui.workers.dev/vectorize/deleteVectorizeIndex/"+encodeURIComponent(m.value),{headers:{"Content-Type":"application/json"}});console.log("deleteIndex後第一次response訊息："),console.log(i),g.value=[{status:"成功",message:"索引刪除完成"}]}catch(i){console.error(i);const r=(c=i.response)==null?void 0:c.data;u.value=(r==null?void 0:r.message)||"刪除索引時發生錯誤"}finally{l.value=!1}},startNumber:y,endNumber:k,batchVectorizeResult:w,isBatchVectorizeLoading:R,batchVectorizeError:I,vectorizeR2FileRange:async()=>{var f;if(!y.value||!k.value){alert("請輸入起始和結束編號");return}const c=parseInt(y.value),i=parseInt(k.value);if(c>i){alert("起始編號不能大於結束編號");return}R.value=!0,I.value="",w.value=[];try{const r=await V.get(`https://knowledge-base-backend.leechiuhui.workers.dev/setupVectorFromR2/${c}/${i}`,{headers:{"Content-Type":"application/json"}});console.log(r),w.value=[{status:"成功",message:`已完成第 ${c} 到第 ${i} 個檔案的向量化`}]}catch(r){console.error(r);const C=(f=r.response)==null?void 0:f.data;I.value=(C==null?void 0:C.message)||"批量向量化處理時發生錯誤"}finally{R.value=!1}}}}}),G={class:"workflow-container"},T={class:"ui segment"},j={class:"ui input"},A={class:"result"},K={key:0,class:"loading"},P={key:1,class:"ui positive message"},S={class:"ui celled table"},x={key:2,class:"ui negative message"},M={class:"description"},q={class:"ui segment"},H={class:"ui input"},J={class:"delete-result"},O={key:0,class:"loading"},Q={key:1,class:"ui positive message"},W={class:"ui celled table"},X={key:2,class:"ui negative message"},Y={class:"description"},Z={class:"ui segment"},_={class:"ui form"},ee={class:"two fields"},se={class:"field"},te={class:"field"},le={class:"batch-vectorize-result"},ae={key:0,class:"loading"},oe={key:1,class:"ui positive message"},ie={class:"ui celled table"},ne={key:2,class:"ui negative message"},de={class:"description"};function re(t,s,v,p,m,g){return o(),a("main",G,[s[29]||(s[29]=$('<h1 class="workflow-title" data-v-c08263c9>創源工具知識庫RAG文件處理流程</h1><div class="workflow-section" data-v-c08263c9><div class="workflow-header" data-v-c08263c9><i class="file archive outline icon" data-v-c08263c9></i><h2 data-v-c08263c9>文件處理與向量化流程</h2></div><div class="workflow-steps" data-v-c08263c9><div class="step-card" data-v-c08263c9><div class="step-number" data-v-c08263c9>01</div><h3 data-v-c08263c9>本地端/Local端文件「doc xls pdf jpg oog png wav mp3」上傳至 Google Drive</h3><div class="step-content" data-v-c08263c9><i class="google drive icon" data-v-c08263c9></i><div class="description" data-v-c08263c9>從本地端/Local端上傳文件到 Google Drive「準備上傳區」</div></div></div><div class="step-card" data-v-c08263c9><div class="step-number" data-v-c08263c9>02</div><h3 data-v-c08263c9>Cloudflare R2 存儲</h3><div class="step-content" data-v-c08263c9><i class="cloud upload icon" data-v-c08263c9></i><div class="description" data-v-c08263c9>將文件傳輸至 Cloudflare R2 存儲</div><div class="tech-tag" data-v-c08263c9>main2.ts</div><ul class="step-details" data-v-c08263c9><li data-v-c08263c9>將文件從 Google Drive「準備上傳區」傳輸至 Cloudflare R2 存儲</li><li data-v-c08263c9>記錄到「Cloudflare D1」數據庫 欄位有：是否已經向量化並進Cloudflare索引庫、文件路徑、檔案名稱、檔案綱要、檔案備註、檔案大小、檔案類型、上傳時間</li><li data-v-c08263c9>移動至 Google Drive「已上傳區」進行備份</li></ul></div></div><div class="step-card" data-v-c08263c9><div class="step-number" data-v-c08263c9>03</div><h3 data-v-c08263c9>向量化處理</h3><div class="step-content" data-v-c08263c9><i class="database icon" data-v-c08263c9></i><div class="description" data-v-c08263c9>將 R2 文件向量化並存入 Cloudflare 索引庫</div><div class="tech-tag" data-v-c08263c9>setupVectorFromR2</div><ul class="step-details" data-v-c08263c9><li data-v-c08263c9>select from Cloudflare D1 數據庫 欄位「是否已經向量化並進Cloudflare索引庫」 等於 false的id選出來</li><li data-v-c08263c9>將 選出的id 從 Cloudflare R2 存儲庫 提取後向量化存入 Cloudflare 索引庫</li><li data-v-c08263c9>更新 Cloudflare D1 數據庫 將欄位「是否已經向量化並進Cloudflare索引庫」 等於 true</li></ul></div></div></div></div><h1 class="ui header" data-v-c08263c9>創源工具-索引建立</h1>',3)),e("div",T,[s[13]||(s[13]=e("h2",null,"步驟一：建立向量索引",-1)),s[14]||(s[14]=e("div",{class:"ui message info"},[e("div",{class:"description"},"此步驟將建立向量索引，用於後續的文件檢索")],-1)),e("div",j,[b(e("input",{type:"text",placeholder:"請輸入索引名稱..","onUpdate:modelValue":s[0]||(s[0]=l=>t.indexName=l),onKeyup:s[1]||(s[1]=D((...l)=>t.createIndex&&t.createIndex(...l),["enter"]))},null,544),[[h,t.indexName]]),e("button",{class:"ui primary button",onClick:s[2]||(s[2]=(...l)=>t.createIndex&&t.createIndex(...l))},s[9]||(s[9]=[e("i",{class:"plus icon"},null,-1),N("建立索引")]))]),e("div",A,[t.isLoading?(o(),a("div",K,"載入中，請稍候...")):t.result.length>0?(o(),a("div",P,[s[11]||(s[11]=e("h3",null,"操作結果",-1)),e("table",S,[s[10]||(s[10]=e("thead",null,[e("tr",null,[e("th",null,"索引名稱"),e("th",null,"狀態"),e("th",null,"訊息")])],-1)),e("tbody",null,[(o(!0),a(z,null,E(t.result,(l,u)=>(o(),a("tr",{key:u},[e("td",null,d(t.indexName),1),e("td",null,d(l.status),1),e("td",null,d(l.message),1)]))),128))])])])):t.error?(o(),a("div",x,[s[12]||(s[12]=e("h3",null,"錯誤訊息",-1)),e("div",M,d(t.error),1)])):L("",!0)])]),e("div",q,[s[19]||(s[19]=e("h2",null,"步驟二：刪除向量索引",-1)),s[20]||(s[20]=e("div",{class:"ui message warning"},[e("div",{class:"description"},"此步驟將刪除向量索引，請謹慎操作")],-1)),e("div",H,[b(e("input",{type:"text",placeholder:"請輸入要刪除的索引名稱..","onUpdate:modelValue":s[3]||(s[3]=l=>t.deleteIndexName=l),onKeyup:s[4]||(s[4]=D((...l)=>t.deleteIndex&&t.deleteIndex(...l),["enter"]))},null,544),[[h,t.deleteIndexName]]),e("button",{class:"ui negative button",onClick:s[5]||(s[5]=(...l)=>t.deleteIndex&&t.deleteIndex(...l))},s[15]||(s[15]=[e("i",{class:"trash icon"},null,-1),N("刪除索引")]))]),e("div",J,[t.isDeleteLoading?(o(),a("div",O,"載入中，請稍候...")):t.deleteResult.length>0?(o(),a("div",Q,[s[17]||(s[17]=e("h3",null,"操作結果",-1)),e("table",W,[s[16]||(s[16]=e("thead",null,[e("tr",null,[e("th",null,"索引名稱"),e("th",null,"狀態"),e("th",null,"訊息")])],-1)),e("tbody",null,[(o(!0),a(z,null,E(t.deleteResult,(l,u)=>(o(),a("tr",{key:u},[e("td",null,d(t.deleteIndexName),1),e("td",null,d(l.status),1),e("td",null,d(l.message),1)]))),128))])])])):t.deleteError?(o(),a("div",X,[s[18]||(s[18]=e("h3",null,"錯誤訊息",-1)),e("div",Y,d(t.deleteError),1)])):L("",!0)])]),e("div",Z,[s[27]||(s[27]=e("h2",null,"步驟四：批量 R2 文件向量化",-1)),s[28]||(s[28]=e("div",{class:"ui message info"},[e("div",{class:"description"},"此步驟將對指定範圍內的 R2 文件進行批量向量化處理")],-1)),e("div",_,[e("div",ee,[e("div",se,[s[21]||(s[21]=e("label",null,"起始檔案編號",-1)),b(e("input",{type:"number",placeholder:"請輸入起始編號..","onUpdate:modelValue":s[6]||(s[6]=l=>t.startNumber=l),min:"1"},null,512),[[h,t.startNumber]])]),e("div",te,[s[22]||(s[22]=e("label",null,"結束檔案編號",-1)),b(e("input",{type:"number",placeholder:"請輸入結束編號..","onUpdate:modelValue":s[7]||(s[7]=l=>t.endNumber=l),min:"1"},null,512),[[h,t.endNumber]])])]),e("button",{class:"ui teal button",onClick:s[8]||(s[8]=(...l)=>t.vectorizeR2FileRange&&t.vectorizeR2FileRange(...l))},s[23]||(s[23]=[e("i",{class:"files icon"},null,-1),N("批量向量化")]))]),e("div",le,[t.isBatchVectorizeLoading?(o(),a("div",ae,"載入中，請稍候...")):t.batchVectorizeResult.length>0?(o(),a("div",oe,[s[25]||(s[25]=e("h3",null,"操作結果",-1)),e("table",ie,[s[24]||(s[24]=e("thead",null,[e("tr",null,[e("th",null,"處理範圍"),e("th",null,"狀態"),e("th",null,"訊息")])],-1)),e("tbody",null,[(o(!0),a(z,null,E(t.batchVectorizeResult,(l,u)=>(o(),a("tr",{key:u},[e("td",null,d(t.startNumber)+" - "+d(t.endNumber),1),e("td",null,d(l.status),1),e("td",null,d(l.message),1)]))),128))])])])):t.batchVectorizeError?(o(),a("div",ne,[s[26]||(s[26]=e("h3",null,"錯誤訊息",-1)),e("div",de,d(t.batchVectorizeError),1)])):L("",!0)])])])}const ge=U(B,[["render",re],["__scopeId","data-v-c08263c9"]]);export{ge as default};
