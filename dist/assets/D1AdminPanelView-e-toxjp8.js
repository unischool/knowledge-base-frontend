import{d as $,r,i as E,b as f,c as a,a as e,h as p,t as i,F as I,f as V,o,n as b,w as z,v as A,g as k,_ as M}from"./index-OyA9nbhG.js";const P=$({name:"D1AdminPanelView",setup(){const n=r([]),t=r(!1),c=r(""),m=r(null),h=r(!1),v=r(""),s=async()=>{try{t.value=!0,c.value="";const l=await f.get("https://knowledge-base-backend.leechiuhui.workers.dev/D1AdminPanel");if(l.data.success)n.value=l.data.data;else throw new Error(l.data.message)}catch(l){console.error("載入錯誤:",l),c.value=l instanceof Error?l.message:"載入資料時發生錯誤"}finally{t.value=!1}},d=l=>l||"未知",g=l=>new Date(l).toLocaleString("zh-TW"),y=async l=>{if(confirm("確定要刪除此筆記錄嗎？")){m.value=l;try{await f.delete("https://knowledge-base-backend.leechiuhui.workers.dev/D1AdminPanel",{data:{id:l}}),n.value=n.value.filter(u=>u.id!==l)}catch(u){console.error("刪除錯誤:",u),c.value="刪除記錄時發生錯誤"}finally{m.value=null}}},w=l=>{var u;h.value=!0,v.value=((u=n.value.find(C=>C.id===l))==null?void 0:u.content)||""},D=async l=>{console.log("saveEdit",v.value),await f.patch("https://knowledge-base-backend.leechiuhui.workers.dev/D1AdminPanel",{data:{id:l,content:v.value}})};return E(()=>{s()}),{records:n,isLoading:t,error:c,isDeletingId:m,formatFileSize:d,formatDate:g,deleteRecord:y,editMode:h,editContent:v,editRecord:w,saveEdit:D}}}),R={class:"d1-admin-container"},F={class:"panel-section"},L={key:0,class:"loading-state"},S={key:1,class:"error-message"},B={class:"ui negative message"},N={key:2,class:"data-table"},T={class:"ui celled table"},U={class:"file-type"},W={class:"content-cell"},_={key:0},j={class:"ui mini vertical buttons"},q=["onClick"],G=["onClick"],H=["onClick"];function J(n,t,c,m,h,v){return o(),a("main",R,[t[9]||(t[9]=e("h1",{class:"panel-title"},"D1 資料庫管理面板",-1)),e("div",F,[t[8]||(t[8]=e("div",{class:"section-header"},[e("i",{class:"database icon"}),e("h2",null,"知識庫索引資料列表")],-1)),n.isLoading?(o(),a("div",L,t[1]||(t[1]=[e("i",{class:"spinner loading icon"},null,-1),e("span",null,"正在載入資料...",-1)]))):p("",!0),n.error?(o(),a("div",S,[e("div",B,[t[2]||(t[2]=e("i",{class:"close icon"},null,-1)),t[3]||(t[3]=e("div",{class:"header"},"發生錯誤",-1)),e("p",null,i(n.error),1)])])):p("",!0),n.records.length>0?(o(),a("div",N,[e("table",T,[t[7]||(t[7]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"向量化狀態"),e("th",null,"檔案路徑"),e("th",null,"檔案名稱"),e("th",null,"檔案大小"),e("th",null,"檔案類型"),e("th",null,"上傳時間"),e("th",null,"向量化時間"),e("th",null,"檔案內容"),e("th",null,"操作")])],-1)),e("tbody",null,[(o(!0),a(I,null,V(n.records,s=>(o(),a("tr",{key:s.id},[e("td",null,i(s.id),1),e("td",null,[e("div",{class:b(["ui label",s.havebeenIndexed?"green":"yellow"])},i(s.havebeenIndexed?"已向量化":"未向量化"),3)]),e("td",null,i(s.filepath),1),e("td",null,i(s.filename),1),e("td",null,i(n.formatFileSize(s.filesize)),1),e("td",U,i(s.filetype),1),e("td",null,i(n.formatDate(s.uploadeddate)),1),e("td",null,i(s.indexeddate?n.formatDate(s.indexeddate):"尚未向量化"),1),e("td",W,[n.editMode?z((o(),a("textarea",{key:1,"onUpdate:modelValue":t[0]||(t[0]=d=>n.editContent=d),rows:"10"},null,512)),[[A,n.editContent]]):(o(),a("span",_,i(s.content),1))]),e("td",null,[e("div",j,[n.editMode?(o(),a("button",{key:1,class:"ui mini primary button",onClick:d=>n.saveEdit(s.id)},t[5]||(t[5]=[e("i",{class:"save icon"},null,-1),k("保存")]),8,G)):(o(),a("button",{key:0,class:"ui mini primary button",onClick:d=>n.editRecord(s.id)},t[4]||(t[4]=[e("i",{class:"edit icon"},null,-1),k("編輯")]),8,q)),e("button",{class:b(["ui mini button",{loading:n.isDeletingId===s.id}]),onClick:d=>n.deleteRecord(s.id)},t[6]||(t[6]=[e("i",{class:"trash icon"},null,-1),k("刪除")]),10,H)])])]))),128))])])])):p("",!0)])])}const O=M(P,[["render",J],["__scopeId","data-v-f053b408"]]);export{O as default};
