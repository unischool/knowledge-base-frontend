import{d as $,r,i as M,b as g,c as a,a as e,h as m,t as o,F as V,f as z,o as d,n as A,w as O,v as P,g as k,_ as F}from"./index-BDVitznL.js";const L=$({name:"D1AdminPanelView",setup(){const l=r([]),t=r(!1),v=r(""),p=r(null),f=r(!1),c=r(""),n=r(null),u=r(""),h=async()=>{try{t.value=!0,v.value="";const s=await g.get("https://knowledge-base-backend.leechiuhui.workers.dev/D1AdminPanel");if(s.data.success)l.value=s.data.data;else throw new Error(s.data.message)}catch(s){console.error("載入錯誤:",s),v.value=s instanceof Error?s.message:"載入資料時發生錯誤"}finally{t.value=!1}},b=s=>s||"未知",y=s=>new Date(s).toLocaleString("zh-TW"),w=async s=>{if(confirm("確定要刪除此筆記錄嗎？")){p.value=s;try{await g.delete("https://knowledge-base-backend.leechiuhui.workers.dev/D1AdminPanel",{data:{id:s}}),l.value=l.value.filter(i=>i.id!==s)}catch(i){console.error("刪除錯誤:",i),v.value="刪除記錄時發生錯誤"}finally{p.value=null}}},D=s=>{n.value=s,f.value=!0;const i=l.value.find(I=>I.id===s);i&&(console.log("record",i),console.log("record.fileoutline",i.fileoutline),console.log("record.content",i.content),u.value=i.fileoutline||i.content||"",c.value=i.fileoutline||i.content||"")},C=async s=>{console.log("saveEdit",c.value),n.value=null,f.value=!1,await g.patch("https://knowledge-base-backend.leechiuhui.workers.dev/D1AdminPanel",{id:s,fileoutline:c.value}).then(i=>{console.log("response",i),h()})},E=()=>{c.value=u.value,n.value=null,f.value=!1};return M(()=>{h()}),{records:l,isLoading:t,error:v,isDeletingId:p,formatFileSize:b,formatDate:y,deleteRecord:w,editingId:n,editMode:f,editOutline:c,editRecord:D,saveEdit:C,cancelEdit:E}}}),R={class:"d1-admin-container"},S={class:"panel-section"},B={key:0,class:"loading-state"},N={key:1,class:"error-message"},T={class:"ui negative message"},U={key:2,class:"data-table"},W={class:"ui celled table"},j={class:"file-type"},q={class:"Outline-cell"},G={key:0},H={key:1,class:"edit-overlay"},J={class:"edit-buttons"},K=["onClick"],Q={class:"ui mini vertical buttons"},X=["onClick"],Y=["onClick"];function Z(l,t,v,p,f,c){return d(),a("main",R,[t[11]||(t[11]=e("h1",{class:"panel-title"},"D1 資料庫管理面板",-1)),e("div",S,[t[10]||(t[10]=e("div",{class:"section-header"},[e("i",{class:"database icon"}),e("h2",null,"知識庫索引資料列表")],-1)),l.isLoading?(d(),a("div",B,t[2]||(t[2]=[e("i",{class:"spinner loading icon"},null,-1),e("span",null,"正在載入資料...",-1)]))):m("",!0),l.error?(d(),a("div",N,[e("div",T,[t[3]||(t[3]=e("i",{class:"close icon"},null,-1)),t[4]||(t[4]=e("div",{class:"header"},"發生錯誤",-1)),e("p",null,o(l.error),1)])])):m("",!0),l.records.length>0?(d(),a("div",U,[e("table",W,[t[9]||(t[9]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"向量化狀態"),e("th",null,"檔案路徑"),e("th",null,"檔案名稱"),e("th",null,"檔案大小"),e("th",null,"檔案類型"),e("th",null,"上傳時間"),e("th",null,"向量化時間"),e("th",null,"檔案大綱"),e("th",null,"操作")])],-1)),e("tbody",null,[(d(!0),a(V,null,z(l.records,n=>(d(),a("tr",{key:n.id},[e("td",null,o(n.id),1),e("td",null,[e("div",{class:A(["ui label",n.havebeenIndexed?"green":"yellow"])},o(n.havebeenIndexed?"已向量化":"未向量化"),3)]),e("td",null,o(n.filepath),1),e("td",null,o(n.filename),1),e("td",null,o(l.formatFileSize(n.filesize)),1),e("td",j,o(n.filetype),1),e("td",null,o(l.formatDate(n.uploadeddate)),1),e("td",null,o(n.indexeddate?l.formatDate(n.indexeddate):"尚未向量化"),1),e("td",q,[!l.editMode||l.editingId!==n.id?(d(),a("span",G,o(n.fileoutline||n.content),1)):m("",!0),l.editMode&&l.editingId===n.id?(d(),a("div",H,[O(e("textarea",{class:"edit-textarea","onUpdate:modelValue":t[0]||(t[0]=u=>l.editOutline=u),rows:"100"},null,512),[[P,l.editOutline]]),e("div",J,[e("button",{class:"ui primary button",onClick:u=>l.saveEdit(n.id)},t[5]||(t[5]=[e("i",{class:"save icon"},"保存",-1)]),8,K),e("button",{class:"ui button",onClick:t[1]||(t[1]=(...u)=>l.cancelEdit&&l.cancelEdit(...u))},t[6]||(t[6]=[e("i",{class:"cancel icon"},"取消",-1)]))])])):m("",!0)]),e("td",null,[e("div",Q,[l.editMode?(d(),a("button",{key:1,class:"ui mini primary button",onClick:u=>l.saveEdit(n.id)},t[8]||(t[8]=[e("i",{class:"save icon"},null,-1),k("保存")]),8,Y)):(d(),a("button",{key:0,class:"ui mini primary button",onClick:u=>l.editRecord(n.id)},t[7]||(t[7]=[e("i",{class:"edit icon"},null,-1),k("編輯")]),8,X))])])]))),128))])])])):m("",!0)])])}const x=F(L,[["render",Z],["__scopeId","data-v-93a264c9"]]);export{x as default};
