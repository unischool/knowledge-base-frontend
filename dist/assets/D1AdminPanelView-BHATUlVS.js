import{d as $,r,i as M,b as h,c as a,a as e,h as f,t as i,F as V,f as z,o,n as A,w as P,v as F,g as k,_ as L}from"./index-CUFlK6O0.js";const R=$({name:"D1AdminPanelView",setup(){const n=r([]),t=r(!1),v=r(""),p=r(null),m=r(!1),c=r(""),l=r(null),d=r(""),g=async()=>{try{t.value=!0,v.value="";const s=await h.get("https://knowledge-base-backend.leechiuhui.workers.dev/D1AdminPanel");if(s.data.success)n.value=s.data.data;else throw new Error(s.data.message)}catch(s){console.error("載入錯誤:",s),v.value=s instanceof Error?s.message:"載入資料時發生錯誤"}finally{t.value=!1}},b=s=>s||"未知",y=s=>new Date(s).toLocaleString("zh-TW"),w=async s=>{if(confirm("確定要刪除此筆記錄嗎？")){p.value=s;try{await h.delete("https://knowledge-base-backend.leechiuhui.workers.dev/D1AdminPanel",{data:{id:s}}),n.value=n.value.filter(u=>u.id!==s)}catch(u){console.error("刪除錯誤:",u),v.value="刪除記錄時發生錯誤"}finally{p.value=null}}},C=s=>{l.value=s,m.value=!0;const u=n.value.find(I=>I.id===s);u&&(d.value=u.content,c.value=u.content)},D=async s=>{console.log("saveEdit",c.value),l.value=null,m.value=!1,await h.patch("https://knowledge-base-backend.leechiuhui.workers.dev/D1AdminPanel",{id:s,content:c.value}).then(u=>{console.log("response",u),g()})},E=()=>{c.value=d.value,l.value=null,m.value=!1};return M(()=>{g()}),{records:n,isLoading:t,error:v,isDeletingId:p,formatFileSize:b,formatDate:y,deleteRecord:w,editingId:l,editMode:m,editContent:c,editRecord:C,saveEdit:D,cancelEdit:E}}}),S={class:"d1-admin-container"},B={class:"panel-section"},N={key:0,class:"loading-state"},T={key:1,class:"error-message"},U={class:"ui negative message"},W={key:2,class:"data-table"},j={class:"ui celled table"},q={class:"file-type"},G={class:"content-cell"},H={key:0},J={key:1,class:"edit-overlay"},K={class:"edit-buttons"},O=["onClick"],Q={class:"ui mini vertical buttons"},X=["onClick"],Y=["onClick"];function Z(n,t,v,p,m,c){return o(),a("main",S,[t[11]||(t[11]=e("h1",{class:"panel-title"},"D1 資料庫管理面板",-1)),e("div",B,[t[10]||(t[10]=e("div",{class:"section-header"},[e("i",{class:"database icon"}),e("h2",null,"知識庫索引資料列表")],-1)),n.isLoading?(o(),a("div",N,t[2]||(t[2]=[e("i",{class:"spinner loading icon"},null,-1),e("span",null,"正在載入資料...",-1)]))):f("",!0),n.error?(o(),a("div",T,[e("div",U,[t[3]||(t[3]=e("i",{class:"close icon"},null,-1)),t[4]||(t[4]=e("div",{class:"header"},"發生錯誤",-1)),e("p",null,i(n.error),1)])])):f("",!0),n.records.length>0?(o(),a("div",W,[e("table",j,[t[9]||(t[9]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"向量化狀態"),e("th",null,"檔案路徑"),e("th",null,"檔案名稱"),e("th",null,"檔案大小"),e("th",null,"檔案類型"),e("th",null,"上傳時間"),e("th",null,"向量化時間"),e("th",null,"檔案內容"),e("th",null,"操作")])],-1)),e("tbody",null,[(o(!0),a(V,null,z(n.records,l=>(o(),a("tr",{key:l.id},[e("td",null,i(l.id),1),e("td",null,[e("div",{class:A(["ui label",l.havebeenIndexed?"green":"yellow"])},i(l.havebeenIndexed?"已向量化":"未向量化"),3)]),e("td",null,i(l.filepath),1),e("td",null,i(l.filename),1),e("td",null,i(n.formatFileSize(l.filesize)),1),e("td",q,i(l.filetype),1),e("td",null,i(n.formatDate(l.uploadeddate)),1),e("td",null,i(l.indexeddate?n.formatDate(l.indexeddate):"尚未向量化"),1),e("td",G,[!n.editMode||n.editingId!==l.id?(o(),a("span",H,i(l.content),1)):f("",!0),n.editMode&&n.editingId===l.id?(o(),a("div",J,[P(e("textarea",{class:"edit-textarea","onUpdate:modelValue":t[0]||(t[0]=d=>n.editContent=d),rows:"100"},null,512),[[F,n.editContent]]),e("div",K,[e("button",{class:"ui primary button",onClick:d=>n.saveEdit(l.id)},t[5]||(t[5]=[e("i",{class:"save icon"},"保存",-1)]),8,O),e("button",{class:"ui button",onClick:t[1]||(t[1]=(...d)=>n.cancelEdit&&n.cancelEdit(...d))},t[6]||(t[6]=[e("i",{class:"cancel icon"},"取消",-1)]))])])):f("",!0)]),e("td",null,[e("div",Q,[n.editMode?(o(),a("button",{key:1,class:"ui mini primary button",onClick:d=>n.saveEdit(l.id)},t[8]||(t[8]=[e("i",{class:"save icon"},null,-1),k("保存")]),8,Y)):(o(),a("button",{key:0,class:"ui mini primary button",onClick:d=>n.editRecord(l.id)},t[7]||(t[7]=[e("i",{class:"edit icon"},null,-1),k("編輯")]),8,X))])])]))),128))])])])):f("",!0)])])}const x=L(R,[["render",Z],["__scopeId","data-v-146ee783"]]);export{x as default};
