import{d as H,r as a,a as y,c as n,b as e,g as f,F as b,f as k,t as d,h as c,w as z,v as V,e as q,o as i,_ as J}from"./index-DLEXnUIi.js";const O=H({name:"AdminPanelView",setup(){const l=a(""),s=a(null),g=a(null),S=v=>{const o=v.target;if(o.files&&o.files[0]){const u=o.files[0];if(!["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/pdf","image/jpeg","image/png","audio/ogg","audio/wav","audio/mpeg"].includes(u.type)){alert("請只上傳：doc, xls, pdf, jpg, oog, png, wav, mp3 的���案格式"),o.value="",g.value=null;return}g.value=u}},R=a(!1),w=a([]),t=a(""),p=a([]),E=a(!1),D=a(""),I=a([]),C=a(!1),T=a(""),N=a(""),F=a([]),G=a(!1),L=a(""),U=a(""),j=a(""),h=a([]),$=a(!1),B=a(""),A=a(!1),K=a([]),M=a("");return{indexName:l,fileInput:s,selectedFile:g,handleFileChange:S,uploadResult:p,isUploadLoading:E,uploadError:D,uploadToGoogleDriveReady:async()=>{var v;if(!g.value){alert("請選擇檔案");return}E.value=!0,D.value="",p.value=[];try{const o=new FormData;o.append("file",g.value),console.log("selectedFile.value.name:",g.value.name),console.log("selectedFile.value.type:",g.value.type),console.log("selectedFile.value.size:",g.value.size),console.log("formData:",o),console.log('formData.get("file"):',o.get("file"));const u=await y.post("https://knowledge-base-backend.leechiuhui.workers.dev/uploadToGoogleDriveReady",o,{headers:{"Content-Type":"multipart/form-data"}});console.log("response:",u),console.log("response.data:",u.data),p.value=[{status:"成功",message:"檔案已上傳至準備區"}]}catch(o){console.log("err:",o),console.error(o);const r=(v=o.response)==null?void 0:v.data;D.value=(r==null?void 0:r.message)||"上傳檔案時發生錯誤"}finally{E.value=!1}},result:I,isLoading:C,error:T,createIndex:async()=>{var v;if(!l.value.trim()){alert("請輸入索引名稱");return}C.value=!0,T.value="",I.value=[];try{const o=await y.get("https://knowledge-base-backend.leechiuhui.workers.dev/vectorize/createVectorizeIndex/"+encodeURIComponent(l.value),{headers:{"Content-Type":"application/json"}});console.log(o),I.value=[{status:"成功",message:"索引建立完成"}]}catch(o){console.error(o);const r=(v=o.response)==null?void 0:v.data;T.value=(r==null?void 0:r.message)||"建立索引時發生錯誤"}finally{C.value=!1}},deleteIndexName:N,deleteResult:F,isDeleteLoading:G,deleteError:L,deleteIndex:async()=>{var v;if(!N.value.trim()){alert("請輸入索引名稱");return}G.value=!0,L.value="",F.value=[];try{const o=await y.get("https://knowledge-base-backend.leechiuhui.workers.dev/vectorize/deleteVectorizeIndex/"+encodeURIComponent(N.value),{headers:{"Content-Type":"application/json"}});console.log("deleteIndex後第一次response訊息："),console.log(o),F.value=[{status:"成功",message:"索引刪除完成"}]}catch(o){console.error(o);const r=(v=o.response)==null?void 0:v.data;L.value=(r==null?void 0:r.message)||"刪除索引時發生錯誤"}finally{G.value=!1}},startNumber:U,endNumber:j,batchVectorizeResult:h,isBatchVectorizeLoading:$,batchVectorizeError:B,vectorizeR2FileRange:async()=>{var u;if(!U.value||!j.value){alert("請輸入起始和結束編號");return}const v=parseInt(U.value),o=parseInt(j.value);if(v>o){alert("起始編號不能大於結束編號");return}$.value=!0,B.value="",h.value=[];try{const r=await y.get(`https://knowledge-base-backend.leechiuhui.workers.dev/setupVectorFromR2/${v}/${o}`,{headers:{"Content-Type":"application/json"}});console.log("&&&&response:",r),console.log("********response.data:",r.data),h.value=[{status:"成功",message:`已完成第 ${v} 到第 ${o} 個檔案的向量化`}],console.log("********batchVectorizeResult:",h.value)}catch(r){console.log("********err:",r),console.error(r);const P=(u=r.response)==null?void 0:u.data;B.value=(P==null?void 0:P.message)||"批量向量化處理時發生錯誤"}finally{$.value=!1}},isMoveLoading:A,moveResult:K,moveError:M,executeGDToR2Upload:async()=>{var o;if(confirm("是否確定要將Google Drive「準備上傳區」的檔案全部搬移到 R2 並寫入D1資料庫？")){A.value=!0,M.value="",K.value=[];try{const u=await y.get("https://knowledge-base-backend.leechiuhui.workers.dev/uploadFromGDToR2",{headers:{"Content-Type":"application/json"}});K.value=[{status:"成功",message:"文件已從「準備上傳區」成功搬移至R2並寫入D1資料庫，並移動至「已上傳區」。"}]}catch(u){const m=(o=u.response)==null?void 0:o.data;M.value=(m==null?void 0:m.message)||"執行從GD到R2操作時發生錯誤"}finally{A.value=!1}}},isVectorizeLoading:R,vectorizeResult:w,vectorizeError:t,executeVectorization:async()=>{var o;if(confirm("是否確定要執行向量化處理？")){R.value=!0,t.value="",w.value=[];try{const u=await y.get("https://knowledge-base-backend.leechiuhui.workers.dev/setupVectorFromR2NotedD1",{headers:{"Content-Type":"application/json"}});w.value=[{status:"成功",message:"已完成文件向量化處理"}]}catch(u){const m=(o=u.response)==null?void 0:o.data;t.value=(m==null?void 0:m.message)||"執行向量化處理時發生錯誤"}finally{R.value=!1}}}}}}),Q={class:"workflow-container"},W={class:"workflow-section"},X={class:"workflow-steps"},Y={class:"step-card"},Z={class:"step-content"},x={class:"ui form"},_={class:"field"},ee={class:"ui action input"},se={class:"upload-result"},le={key:0,class:"loading"},te={key:1,class:"ui positive message"},oe={class:"ui celled table"},ne={key:2,class:"ui negative message"},ie={class:"description"},ae={class:"step-card"},de={class:"step-content"},re={class:"move-result"},ue={key:0,class:"loading"},ve={key:1,class:"ui positive message"},pe={class:"ui celled table"},ge={key:2,class:"ui negative message"},me={class:"description"},ce={class:"step-card"},fe={class:"step-content"},ye={class:"vectorize-result"},be={key:0,class:"loading"},ke={key:1,class:"ui positive message"},Re={class:"ui celled table"},we={key:2,class:"ui negative message"},he={class:"description"},ze={class:"ui segment"},Ve={class:"ui input"},Ee={class:"result"},De={key:0,class:"loading"},Ie={key:1,class:"ui positive message"},Ce={class:"ui celled table"},Te={key:2,class:"ui negative message"},Ne={class:"description"},Fe={class:"ui segment"},Ge={class:"ui input"},Le={class:"delete-result"},Ue={key:0,class:"loading"},je={key:1,class:"ui positive message"},$e={class:"ui celled table"},Be={key:2,class:"ui negative message"},Ae={class:"description"},Ke={class:"ui segment"},Me={class:"ui form"},Pe={class:"two fields"},Se={class:"field"},qe={class:"field"},He={class:"batch-vectorize-result"},Je={key:0,class:"loading"},Oe={key:1,class:"ui positive message"},Qe={class:"ui celled table"},We={key:2,class:"ui negative message"},Xe={class:"description"};function Ye(l,s,g,S,R,w){return i(),n("main",Q,[s[66]||(s[66]=e("h1",{class:"workflow-title"},"創源工具知識庫RAG文件處理流程",-1)),e("div",W,[s[45]||(s[45]=e("div",{class:"workflow-header"},[e("i",{class:"file archive outline icon"}),e("h2",null,"文件處理與向量化流程")],-1)),e("div",X,[e("div",Y,[s[22]||(s[22]=e("div",{class:"step-number"},"01",-1)),s[23]||(s[23]=e("h3",null,"從本地端/Local端 將文件「doc xls pdf jpg oog png wav mp3」上傳至 Google Drive「準備上傳區」",-1)),e("div",Z,[s[18]||(s[18]=e("i",{class:"google drive icon"},null,-1)),s[19]||(s[19]=e("div",{class:"description"},null,-1)),s[20]||(s[20]=e("div",{class:"step-content"},null,-1)),s[21]||(s[21]=e("div",{class:"tech-tag"},"uploadToGoogleDriveReady.ts",-1)),e("div",x,[e("div",_,[s[14]||(s[14]=e("label",null,"選擇文件",-1)),e("div",ee,[e("input",{type:"file",ref:"fileInput",onChange:s[0]||(s[0]=(...t)=>l.handleFileChange&&l.handleFileChange(...t)),accept:"doc, xls, pdf, jpg, oog, png, wav, mp3",style:{display:"inline-block"}},null,544),e("button",{class:"ui primary button",onClick:s[1]||(s[1]=(...t)=>l.uploadToGoogleDriveReady&&l.uploadToGoogleDriveReady(...t))},s[13]||(s[13]=[e("i",{class:"upload icon"},null,-1),f("上傳至準備區")]))])])]),e("div",se,[l.isUploadLoading?(i(),n("div",le,"載入中，請稍候...")):l.uploadResult.length>0?(i(),n("div",te,[s[16]||(s[16]=e("h3",null,"操作結果",-1)),e("table",oe,[s[15]||(s[15]=e("thead",null,[e("tr",null,[e("th",null,"檔案名稱"),e("th",null,"狀態"),e("th",null,"訊息")])],-1)),e("tbody",null,[(i(!0),n(b,null,k(l.uploadResult,(t,p)=>(i(),n("tr",{key:p},[e("td",null,d(l.selectedFile.name),1),e("td",null,d(t.status),1),e("td",null,d(t.message),1)]))),128))])])])):l.uploadError?(i(),n("div",ne,[s[17]||(s[17]=e("h3",null,"錯誤訊息",-1)),e("div",ie,d(l.uploadError),1)])):c("",!0)])])]),e("div",ae,[s[33]||(s[33]=e("div",{class:"step-number"},"02",-1)),s[34]||(s[34]=e("h3",null,"將文件從 Google Drive「準備上傳區」傳輸至 Cloudflare R2 存儲->寫入Cloudflare D1資料庫->移動至 Google Drive「已上傳區」進行備份",-1)),e("div",de,[s[29]||(s[29]=e("i",{class:"cloud upload icon"},null,-1)),s[30]||(s[30]=e("div",{class:"description"},null,-1)),s[31]||(s[31]=e("div",{class:"tech-tag"},"uploadFromGDToR2.ts",-1)),s[32]||(s[32]=e("ul",{class:"step-details"},null,-1)),e("button",{class:"ui primary button",onClick:s[2]||(s[2]=(...t)=>l.executeGDToR2Upload&&l.executeGDToR2Upload(...t))},s[24]||(s[24]=[e("i",{class:"upload icon"},null,-1),f("執行「準備上傳區」-> R2 並寫DB(確認後執行)")])),e("div",re,[l.isMoveLoading?(i(),n("div",ue,"載入中，請稍候...")):l.moveResult.length>0?(i(),n("div",ve,[s[26]||(s[26]=e("h3",null,"操作結果",-1)),e("table",pe,[s[25]||(s[25]=e("thead",null,[e("tr",null,[e("th",null,"狀態"),e("th",null,"訊息")])],-1)),e("tbody",null,[(i(!0),n(b,null,k(l.moveResult,(t,p)=>(i(),n("tr",{key:p},[e("td",null,d(t.status),1),e("td",null,d(t.message),1)]))),128))])])])):l.moveError?(i(),n("div",ge,[s[27]||(s[27]=f("// 新增")),s[28]||(s[28]=e("h3",null,"錯誤訊息",-1)),e("div",me,d(l.moveError),1)])):c("",!0)])])]),e("div",ce,[s[43]||(s[43]=e("div",{class:"step-number"},"03",-1)),s[44]||(s[44]=e("h3",null,"向量化處理",-1)),e("div",fe,[s[39]||(s[39]=e("i",{class:"database icon"},null,-1)),s[40]||(s[40]=e("div",{class:"description"},"找出D1資料庫中 未向量化的文件id->從R2提取文件後 向量化並存入 Cloudflare 索引庫->更新D1資料庫",-1)),s[41]||(s[41]=e("div",{class:"tech-tag"},"setupVectorFromR2NotedD1.ts",-1)),s[42]||(s[42]=e("ul",{class:"step-details"},null,-1)),e("button",{class:"ui primary button",onClick:s[3]||(s[3]=(...t)=>l.executeVectorization&&l.executeVectorization(...t))},s[35]||(s[35]=[e("i",{class:"sync icon"},null,-1),f("執行向量化處理(確認後執行)")])),e("div",ye,[l.isVectorizeLoading?(i(),n("div",be,"載入中，請稍候...")):c("",!0),l.vectorizeResult.length>0?(i(),n("div",ke,[s[37]||(s[37]=e("h3",null,"操作結果",-1)),e("table",Re,[s[36]||(s[36]=e("thead",null,[e("tr",null,[e("th",null,"狀態"),e("th",null,"訊息")])],-1)),e("tbody",null,[(i(!0),n(b,null,k(l.vectorizeResult,(t,p)=>(i(),n("tr",{key:p},[e("td",null,d(t.status),1),e("td",null,d(t.message),1)]))),128))])])])):c("",!0),l.vectorizeError?(i(),n("div",we,[s[38]||(s[38]=e("h3",null,"錯誤訊息",-1)),e("div",he,d(l.vectorizeError),1)])):c("",!0)])])])])]),s[67]||(s[67]=e("h1",{class:"ui header"},"創源工具-索引建立",-1)),e("div",ze,[s[50]||(s[50]=e("h2",null,"步驟一：建立向量索引",-1)),s[51]||(s[51]=e("div",{class:"ui message info"},[e("div",{class:"description"},"此步驟將建立向量索引，用於後續的文件檢索")],-1)),e("div",Ve,[z(e("input",{type:"text",placeholder:"請輸入索引名稱..","onUpdate:modelValue":s[4]||(s[4]=t=>l.indexName=t),onKeyup:s[5]||(s[5]=q((...t)=>l.createIndex&&l.createIndex(...t),["enter"]))},null,544),[[V,l.indexName]]),e("button",{class:"ui primary button",onClick:s[6]||(s[6]=(...t)=>l.createIndex&&l.createIndex(...t))},s[46]||(s[46]=[e("i",{class:"plus icon"},null,-1),f("建立索引")]))]),e("div",Ee,[l.isLoading?(i(),n("div",De,"載入中，請稍候...")):l.result.length>0?(i(),n("div",Ie,[s[48]||(s[48]=e("h3",null,"操作結果",-1)),e("table",Ce,[s[47]||(s[47]=e("thead",null,[e("tr",null,[e("th",null,"索引名稱"),e("th",null,"狀態"),e("th",null,"訊息")])],-1)),e("tbody",null,[(i(!0),n(b,null,k(l.result,(t,p)=>(i(),n("tr",{key:p},[e("td",null,d(l.indexName),1),e("td",null,d(t.status),1),e("td",null,d(t.message),1)]))),128))])])])):l.error?(i(),n("div",Te,[s[49]||(s[49]=e("h3",null,"錯誤訊息",-1)),e("div",Ne,d(l.error),1)])):c("",!0)])]),e("div",Fe,[s[56]||(s[56]=e("h2",null,"步驟二：刪除向量索引",-1)),s[57]||(s[57]=e("div",{class:"ui message warning"},[e("div",{class:"description"},"此步驟將刪除向量索引，請謹慎操作")],-1)),e("div",Ge,[z(e("input",{type:"text",placeholder:"請輸入要刪除的索引名稱..","onUpdate:modelValue":s[7]||(s[7]=t=>l.deleteIndexName=t),onKeyup:s[8]||(s[8]=q((...t)=>l.deleteIndex&&l.deleteIndex(...t),["enter"]))},null,544),[[V,l.deleteIndexName]]),e("button",{class:"ui negative button",onClick:s[9]||(s[9]=(...t)=>l.deleteIndex&&l.deleteIndex(...t))},s[52]||(s[52]=[e("i",{class:"trash icon"},null,-1),f("刪除索引")]))]),e("div",Le,[l.isDeleteLoading?(i(),n("div",Ue,"載入中，請稍候...")):l.deleteResult.length>0?(i(),n("div",je,[s[54]||(s[54]=e("h3",null,"操作結果",-1)),e("table",$e,[s[53]||(s[53]=e("thead",null,[e("tr",null,[e("th",null,"索引名稱"),e("th",null,"狀態"),e("th",null,"訊息")])],-1)),e("tbody",null,[(i(!0),n(b,null,k(l.deleteResult,(t,p)=>(i(),n("tr",{key:p},[e("td",null,d(l.deleteIndexName),1),e("td",null,d(t.status),1),e("td",null,d(t.message),1)]))),128))])])])):l.deleteError?(i(),n("div",Be,[s[55]||(s[55]=e("h3",null,"錯誤訊息",-1)),e("div",Ae,d(l.deleteError),1)])):c("",!0)])]),e("div",Ke,[s[64]||(s[64]=e("h2",null,"步驟四：批量 R2 文件向量化",-1)),s[65]||(s[65]=e("div",{class:"ui message info"},[e("div",{class:"description"},"此步驟將對指定範圍內的 R2 文件進行批量向量化處理")],-1)),e("div",Me,[e("div",Pe,[e("div",Se,[s[58]||(s[58]=e("label",null,"起始檔案編號",-1)),z(e("input",{type:"number",placeholder:"請輸入起始編號..","onUpdate:modelValue":s[10]||(s[10]=t=>l.startNumber=t),min:"1"},null,512),[[V,l.startNumber]])]),e("div",qe,[s[59]||(s[59]=e("label",null,"結束檔案編號",-1)),z(e("input",{type:"number",placeholder:"請輸入結束編號..","onUpdate:modelValue":s[11]||(s[11]=t=>l.endNumber=t),min:"1"},null,512),[[V,l.endNumber]])])]),e("button",{class:"ui teal button",onClick:s[12]||(s[12]=(...t)=>l.vectorizeR2FileRange&&l.vectorizeR2FileRange(...t))},s[60]||(s[60]=[e("i",{class:"files icon"},null,-1),f("批量向量化")]))]),e("div",He,[l.isBatchVectorizeLoading?(i(),n("div",Je,"載入中，請稍候...")):l.batchVectorizeResult.length>0?(i(),n("div",Oe,[s[62]||(s[62]=e("h3",null,"操作結果",-1)),e("table",Qe,[s[61]||(s[61]=e("thead",null,[e("tr",null,[e("th",null,"處理範圍"),e("th",null,"狀態"),e("th",null,"訊息")])],-1)),e("tbody",null,[(i(!0),n(b,null,k(l.batchVectorizeResult,(t,p)=>(i(),n("tr",{key:p},[e("td",null,d(l.startNumber)+" - "+d(l.endNumber),1),e("td",null,d(t.status),1),e("td",null,d(t.message),1)]))),128))])])])):l.batchVectorizeError?(i(),n("div",We,[s[63]||(s[63]=e("h3",null,"錯誤訊息",-1)),e("div",Xe,d(l.batchVectorizeError),1)])):c("",!0)])])])}const os=J(O,[["render",Ye],["__scopeId","data-v-6fe99de1"]]);export{os as default};
