import{d as P,r as a,a as f,c as n,b as e,e as m,F as c,g as y,t as r,h as b,i as S,w as C,v as I,f as M,o as i,_ as q}from"./index-FaWwXZno.js";const H=P({name:"AdminPanelView",setup(){const l=a(""),s=a(null),g=a(null),K=u=>{const t=u.target;if(t.files&&t.files[0]){const v=t.files[0];if(!["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/pdf","image/jpeg","image/png","audio/ogg","audio/wav","audio/mpeg"].includes(v.type)){alert("請只上傳：doc, xls, pdf, jpg, oog, png, wav, mp3 的檔案格式"),t.value="",g.value=null;return}g.value=v}},k=a([]),R=a(!1),o=a(""),p=a([]),D=a(!1),E=a(""),V=a(""),z=a([]),N=a(!1),T=a(""),F=a(""),G=a(""),w=a([]),L=a(!1),U=a(""),j=a(!1),$=a([]),B=a("");return{indexName:l,fileInput:s,selectedFile:g,handleFileChange:K,uploadResult:k,isUploadLoading:R,uploadError:o,uploadToGoogleDriveReady:async()=>{var u;if(!g.value){alert("請選擇檔案");return}R.value=!0,o.value="",k.value=[];try{const t=new FormData;t.append("file",g.value),console.log("selectedFile.value.name:",g.value.name),console.log("selectedFile.value.type:",g.value.type),console.log("selectedFile.value.size:",g.value.size),console.log("formData:",t),console.log('formData.get("file"):',t.get("file"));const v=await f.post("https://knowledge-base-backend.leechiuhui.workers.dev/uploadToGoogleDriveReady",t,{headers:{"Content-Type":"multipart/form-data"}});console.log("response:",v),console.log("response.data:",v.data),k.value=[{status:"成功",message:"檔案已上傳至準備區"}]}catch(t){console.log("err:",t),console.error(t);const d=(u=t.response)==null?void 0:u.data;o.value=(d==null?void 0:d.message)||"上傳檔案時發生錯誤"}finally{R.value=!1}},result:p,isLoading:D,error:E,createIndex:async()=>{var u;if(!l.value.trim()){alert("請輸入索引名稱");return}D.value=!0,E.value="",p.value=[];try{const t=await f.get("https://knowledge-base-backend.leechiuhui.workers.dev/vectorize/createVectorizeIndex/"+encodeURIComponent(l.value),{headers:{"Content-Type":"application/json"}});console.log(t),p.value=[{status:"成功",message:"索引建立完成"}]}catch(t){console.error(t);const d=(u=t.response)==null?void 0:u.data;E.value=(d==null?void 0:d.message)||"建立索引時發生錯誤"}finally{D.value=!1}},deleteIndexName:V,deleteResult:z,isDeleteLoading:N,deleteError:T,deleteIndex:async()=>{var u;if(!V.value.trim()){alert("請輸入索引名稱");return}N.value=!0,T.value="",z.value=[];try{const t=await f.get("https://knowledge-base-backend.leechiuhui.workers.dev/vectorize/deleteVectorizeIndex/"+encodeURIComponent(V.value),{headers:{"Content-Type":"application/json"}});console.log("deleteIndex後第一次response訊息："),console.log(t),z.value=[{status:"成功",message:"索引刪除完成"}]}catch(t){console.error(t);const d=(u=t.response)==null?void 0:u.data;T.value=(d==null?void 0:d.message)||"刪除索引時發生錯誤"}finally{N.value=!1}},startNumber:F,endNumber:G,batchVectorizeResult:w,isBatchVectorizeLoading:L,batchVectorizeError:U,vectorizeR2FileRange:async()=>{var v;if(!F.value||!G.value){alert("請輸入起始和結束編號");return}const u=parseInt(F.value),t=parseInt(G.value);if(u>t){alert("起始編號不能大於結束編號");return}L.value=!0,U.value="",w.value=[];try{const d=await f.get(`https://knowledge-base-backend.leechiuhui.workers.dev/setupVectorFromR2/${u}/${t}`,{headers:{"Content-Type":"application/json"}});console.log("&&&&response:",d),console.log("********response.data:",d.data),w.value=[{status:"成功",message:`已完成第 ${u} 到第 ${t} 個檔案的向量化`}],console.log("********batchVectorizeResult:",w.value)}catch(d){console.log("********err:",d),console.error(d);const A=(v=d.response)==null?void 0:v.data;U.value=(A==null?void 0:A.message)||"批量向量化處理時發生錯誤"}finally{L.value=!1}},isMoveLoading:j,moveResult:$,moveError:B,executeGDToR2Upload:async()=>{var t;if(confirm("是否確定要將Google Drive「準備上傳區」的檔案全部搬移到 R2 並寫入D1資料庫？")){j.value=!0,B.value="",$.value=[];try{const v=await f.get("https://knowledge-base-backend.leechiuhui.workers.dev/uploadFromGDToR2",{headers:{"Content-Type":"application/json"}});$.value=[{status:"成功",message:"文件已從「準備上傳區」成功搬移至R2並寫入D1資料庫，並移動至「已上傳區」。"}]}catch(v){const h=(t=v.response)==null?void 0:t.data;B.value=(h==null?void 0:h.message)||"執行從GD到R2操作時發生錯誤"}finally{j.value=!1}}}}}}),J={class:"workflow-container"},O={class:"workflow-section"},Q={class:"workflow-steps"},W={class:"step-card"},X={class:"step-content"},Y={class:"ui form"},Z={class:"field"},x={class:"ui action input"},_={class:"upload-result"},ee={key:0,class:"loading"},se={key:1,class:"ui positive message"},le={class:"ui celled table"},oe={key:2,class:"ui negative message"},te={class:"description"},ne={class:"step-card"},ie={class:"step-content"},ae={class:"move-result"},de={key:0,class:"loading"},re={key:1,class:"ui positive message"},ue={class:"ui celled table"},ve={key:2,class:"ui negative message"},pe={class:"description"},ge={class:"ui segment"},me={class:"ui input"},fe={class:"result"},ce={key:0,class:"loading"},ye={key:1,class:"ui positive message"},be={class:"ui celled table"},ke={key:2,class:"ui negative message"},Re={class:"description"},we={class:"ui segment"},he={class:"ui input"},Ce={class:"delete-result"},Ie={key:0,class:"loading"},De={key:1,class:"ui positive message"},Ee={class:"ui celled table"},Ve={key:2,class:"ui negative message"},ze={class:"description"},Ne={class:"ui segment"},Te={class:"ui form"},Fe={class:"two fields"},Ge={class:"field"},Le={class:"field"},Ue={class:"batch-vectorize-result"},je={key:0,class:"loading"},$e={key:1,class:"ui positive message"},Be={class:"ui celled table"},Ae={key:2,class:"ui negative message"},Ke={class:"description"};function Me(l,s,g,K,k,R){return i(),n("main",J,[s[54]||(s[54]=e("h1",{class:"workflow-title"},"創源工具知識庫RAG文件處理流程",-1)),e("div",O,[s[33]||(s[33]=e("div",{class:"workflow-header"},[e("i",{class:"file archive outline icon"}),e("h2",null,"文件處理與向量化流程")],-1)),e("div",Q,[e("div",W,[s[19]||(s[19]=e("div",{class:"step-number"},"01",-1)),s[20]||(s[20]=e("h3",null,"本地端/Local端文件「doc xls pdf jpg oog png wav mp3」上傳至 Google Drive",-1)),e("div",X,[s[17]||(s[17]=e("i",{class:"google drive icon"},null,-1)),s[18]||(s[18]=e("div",{class:"description"},"從本地端/Local端上傳文件到 Google Drive「準備上傳區」",-1)),e("div",Y,[e("div",Z,[s[13]||(s[13]=e("label",null,"選擇文件",-1)),e("div",x,[e("input",{type:"file",ref:"fileInput",onChange:s[0]||(s[0]=(...o)=>l.handleFileChange&&l.handleFileChange(...o)),accept:"doc, xls, pdf, jpg, oog, png, wav, mp3",style:{display:"inline-block"}},null,544),e("button",{class:"ui primary button",onClick:s[1]||(s[1]=(...o)=>l.uploadToGoogleDriveReady&&l.uploadToGoogleDriveReady(...o))},s[12]||(s[12]=[e("i",{class:"upload icon"},null,-1),m("上傳至準備區")]))])])]),e("div",_,[l.isUploadLoading?(i(),n("div",ee,"載入中，請稍候...")):l.uploadResult.length>0?(i(),n("div",se,[s[15]||(s[15]=e("h3",null,"操作結果",-1)),e("table",le,[s[14]||(s[14]=e("thead",null,[e("tr",null,[e("th",null,"檔案名稱"),e("th",null,"狀態"),e("th",null,"訊息")])],-1)),e("tbody",null,[(i(!0),n(c,null,y(l.uploadResult,(o,p)=>(i(),n("tr",{key:p},[e("td",null,r(l.selectedFile.name),1),e("td",null,r(o.status),1),e("td",null,r(o.message),1)]))),128))])])])):l.uploadError?(i(),n("div",oe,[s[16]||(s[16]=e("h3",null,"錯誤訊息",-1)),e("div",te,r(l.uploadError),1)])):b("",!0)])])]),e("div",ne,[s[30]||(s[30]=e("div",{class:"step-number"},"02",-1)),s[31]||(s[31]=e("h3",null,"Cloudflare R2 存儲",-1)),e("div",ie,[s[26]||(s[26]=e("i",{class:"cloud upload icon"},null,-1)),s[27]||(s[27]=e("div",{class:"description"},"將文件傳輸至 Cloudflare R2 存儲",-1)),s[28]||(s[28]=e("div",{class:"tech-tag"},"main2.ts",-1)),s[29]||(s[29]=e("ul",{class:"step-details"},[e("li",null,"將文件從 Google Drive「準備上傳區」傳輸至 Cloudflare R2 存儲"),e("li",null,"記錄到「Cloudflare D1」數據庫 欄位有：是否已經向量化並進Cloudflare索引庫、文件路徑、檔案名稱、檔案綱要、檔案備註、檔案大小、檔案類型、上傳時間"),e("li",null,"移動至 Google Drive「已上傳區」進行備份")],-1)),e("button",{class:"ui primary button",onClick:s[2]||(s[2]=(...o)=>l.executeGDToR2Upload&&l.executeGDToR2Upload(...o))},s[21]||(s[21]=[e("i",{class:"upload icon"},null,-1),m("執行「準備上傳區」-> R2 並寫DB(確認後執行)")])),e("div",ae,[l.isMoveLoading?(i(),n("div",de,"載入中，請稍候...")):l.moveResult.length>0?(i(),n("div",re,[s[23]||(s[23]=e("h3",null,"操作結果",-1)),e("table",ue,[s[22]||(s[22]=e("thead",null,[e("tr",null,[e("th",null,"狀態"),e("th",null,"訊息")])],-1)),e("tbody",null,[(i(!0),n(c,null,y(l.moveResult,(o,p)=>(i(),n("tr",{key:p},[e("td",null,r(o.status),1),e("td",null,r(o.message),1)]))),128))])])])):l.moveError?(i(),n("div",ve,[s[24]||(s[24]=m("// 新增")),s[25]||(s[25]=e("h3",null,"錯誤訊息",-1)),e("div",pe,r(l.moveError),1)])):b("",!0)])])]),s[32]||(s[32]=S('<div class="step-card" data-v-2f6663f2><div class="step-number" data-v-2f6663f2>03</div><h3 data-v-2f6663f2>向量化處理</h3><div class="step-content" data-v-2f6663f2><i class="database icon" data-v-2f6663f2></i><div class="description" data-v-2f6663f2>將 R2 文件向量化並存入 Cloudflare 索引庫</div><div class="tech-tag" data-v-2f6663f2>setupVectorFromR2</div><ul class="step-details" data-v-2f6663f2><li data-v-2f6663f2>select from Cloudflare D1 數據庫 欄位「是否已經向量化並進Cloudflare索引庫」 等於 false的id選出來</li><li data-v-2f6663f2>將 選出的id 從 Cloudflare R2 存儲庫 提取後向量化存入 Cloudflare 索引庫</li><li data-v-2f6663f2>更新 Cloudflare D1 數據庫 將欄位「是否已經向量化並進Cloudflare索引庫」 等於 true</li></ul></div></div>',1))])]),s[55]||(s[55]=e("h1",{class:"ui header"},"創源工具-索引建立",-1)),e("div",ge,[s[38]||(s[38]=e("h2",null,"步驟一：建立向量索引",-1)),s[39]||(s[39]=e("div",{class:"ui message info"},[e("div",{class:"description"},"此步驟將建立向量索引，用於後續的文件檢索")],-1)),e("div",me,[C(e("input",{type:"text",placeholder:"請輸入索引名稱..","onUpdate:modelValue":s[3]||(s[3]=o=>l.indexName=o),onKeyup:s[4]||(s[4]=M((...o)=>l.createIndex&&l.createIndex(...o),["enter"]))},null,544),[[I,l.indexName]]),e("button",{class:"ui primary button",onClick:s[5]||(s[5]=(...o)=>l.createIndex&&l.createIndex(...o))},s[34]||(s[34]=[e("i",{class:"plus icon"},null,-1),m("建立索引")]))]),e("div",fe,[l.isLoading?(i(),n("div",ce,"載入中，請稍候...")):l.result.length>0?(i(),n("div",ye,[s[36]||(s[36]=e("h3",null,"操作結果",-1)),e("table",be,[s[35]||(s[35]=e("thead",null,[e("tr",null,[e("th",null,"索引名稱"),e("th",null,"狀態"),e("th",null,"訊息")])],-1)),e("tbody",null,[(i(!0),n(c,null,y(l.result,(o,p)=>(i(),n("tr",{key:p},[e("td",null,r(l.indexName),1),e("td",null,r(o.status),1),e("td",null,r(o.message),1)]))),128))])])])):l.error?(i(),n("div",ke,[s[37]||(s[37]=e("h3",null,"錯誤訊息",-1)),e("div",Re,r(l.error),1)])):b("",!0)])]),e("div",we,[s[44]||(s[44]=e("h2",null,"步驟二：刪除向量索引",-1)),s[45]||(s[45]=e("div",{class:"ui message warning"},[e("div",{class:"description"},"此步驟將刪除向量索引，請謹慎操作")],-1)),e("div",he,[C(e("input",{type:"text",placeholder:"請輸入要刪除的索引名稱..","onUpdate:modelValue":s[6]||(s[6]=o=>l.deleteIndexName=o),onKeyup:s[7]||(s[7]=M((...o)=>l.deleteIndex&&l.deleteIndex(...o),["enter"]))},null,544),[[I,l.deleteIndexName]]),e("button",{class:"ui negative button",onClick:s[8]||(s[8]=(...o)=>l.deleteIndex&&l.deleteIndex(...o))},s[40]||(s[40]=[e("i",{class:"trash icon"},null,-1),m("刪除索引")]))]),e("div",Ce,[l.isDeleteLoading?(i(),n("div",Ie,"載入中，請稍候...")):l.deleteResult.length>0?(i(),n("div",De,[s[42]||(s[42]=e("h3",null,"操作結果",-1)),e("table",Ee,[s[41]||(s[41]=e("thead",null,[e("tr",null,[e("th",null,"索引名稱"),e("th",null,"狀態"),e("th",null,"訊息")])],-1)),e("tbody",null,[(i(!0),n(c,null,y(l.deleteResult,(o,p)=>(i(),n("tr",{key:p},[e("td",null,r(l.deleteIndexName),1),e("td",null,r(o.status),1),e("td",null,r(o.message),1)]))),128))])])])):l.deleteError?(i(),n("div",Ve,[s[43]||(s[43]=e("h3",null,"錯誤訊息",-1)),e("div",ze,r(l.deleteError),1)])):b("",!0)])]),e("div",Ne,[s[52]||(s[52]=e("h2",null,"步驟四：批量 R2 文件向量化",-1)),s[53]||(s[53]=e("div",{class:"ui message info"},[e("div",{class:"description"},"此步驟將對指定範圍內的 R2 文件進行批量向量化處理")],-1)),e("div",Te,[e("div",Fe,[e("div",Ge,[s[46]||(s[46]=e("label",null,"起始檔案編號",-1)),C(e("input",{type:"number",placeholder:"請輸入起始編號..","onUpdate:modelValue":s[9]||(s[9]=o=>l.startNumber=o),min:"1"},null,512),[[I,l.startNumber]])]),e("div",Le,[s[47]||(s[47]=e("label",null,"結束檔案編號",-1)),C(e("input",{type:"number",placeholder:"請輸入結束編號..","onUpdate:modelValue":s[10]||(s[10]=o=>l.endNumber=o),min:"1"},null,512),[[I,l.endNumber]])])]),e("button",{class:"ui teal button",onClick:s[11]||(s[11]=(...o)=>l.vectorizeR2FileRange&&l.vectorizeR2FileRange(...o))},s[48]||(s[48]=[e("i",{class:"files icon"},null,-1),m("批量向量化")]))]),e("div",Ue,[l.isBatchVectorizeLoading?(i(),n("div",je,"載入中，請稍候...")):l.batchVectorizeResult.length>0?(i(),n("div",$e,[s[50]||(s[50]=e("h3",null,"操作結果",-1)),e("table",Be,[s[49]||(s[49]=e("thead",null,[e("tr",null,[e("th",null,"處理範圍"),e("th",null,"狀態"),e("th",null,"訊息")])],-1)),e("tbody",null,[(i(!0),n(c,null,y(l.batchVectorizeResult,(o,p)=>(i(),n("tr",{key:p},[e("td",null,r(l.startNumber)+" - "+r(l.endNumber),1),e("td",null,r(o.status),1),e("td",null,r(o.message),1)]))),128))])])])):l.batchVectorizeError?(i(),n("div",Ae,[s[51]||(s[51]=e("h3",null,"錯誤訊息",-1)),e("div",Ke,r(l.batchVectorizeError),1)])):b("",!0)])])])}const Qe=q(H,[["render",Me],["__scopeId","data-v-2f6663f2"]]);export{Qe as default};
